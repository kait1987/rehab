# REHAB 재활운동 어플리케이션 - TODO 로드맵

본 문서는 PRD.md를 기반으로 한 재활운동 어플리케이션의 개발 로드맵입니다.

---

## 🚀 현재 진행 상황 (Current Status)

### ✅ 완료된 작업 (Done)

- [x] 프로젝트 초기 세팅 (Next.js + Supabase Boilerplate)
- [x] Supabase PostgreSQL 연결 ✅
- [x] Prisma 설정 및 초기 데이터(Form Roller) 표시 성공
- [x] 기존 템플릿 디자인(Velvet) 제거 및 초기화
- [x] 로그인/회원가입 라이브러리(Clerk) 설치 및 설정 완료 ✅
- [x] 아이콘 라이브러리(Lucide React) 설치 완료

#### 2026-01-09 완료 작업 ✅

- [x] 코스 저장 API 검증 (`/api/courses/save` 정상 작동)
- [x] 코스 목록 API 생성 (`/api/courses` GET 엔드포인트)
- [x] 내 코스 페이지 생성 (`/my/courses/page.tsx`)
- [x] 운동 데이터 보강 (등 3→5개, 가슴 4→5개, 팔 5→6개, 다리 5→6개)
- [x] 비활성 운동 필터링 수정 (`merge-body-parts.ts` L99-102)
- [x] 기구 필터링 로직 개선 (`some()` → `every()`)
- [x] 메인 운동 intensity 수정 (목/손목/팔꿈치/등 부위)
- [x] 중복 key 에러 수정 (운동 반복 시 고유 key 생성)

---

## ✅ PHASE 1: Foundation MVP (핵심 기능 완성)

### 🎯 목표

- 동네 기반 재활 헬스장 추천
- 60/90/120분 재활 코스 생성
- 태그 기반 리뷰 시스템
- 모바일 웹 제공

---

### 📌 1. 백엔드/데이터베이스

#### 1.1 DB 기본 스키마 구축

- [x] `gyms` 테이블 생성 (헬스장 기본 정보)
- [x] `gym_facilities` 테이블 생성 (시설 정보)
- [x] `gym_operating_hours` 테이블 생성 (운영시간)
- [x] `gym_crowd_levels` 테이블 생성 (혼잡도 정보)
- [x] `reviews` 테이블 생성 (리뷰 기본 정보)
- [x] `review_tags` 테이블 생성 (리뷰 태그 마스터)
- [x] `review_tag_mappings` 테이블 생성 (리뷰-태그 매핑)
- [x] `courses` 테이블 생성 (재활 코스 기본 정보)
- [x] `course_exercises` 테이블 생성 (코스 내 운동 목록)
- [x] `exercise_templates` 테이블 생성 (운동 템플릿)
- [x] `body_parts` 테이블 생성 (부위 마스터)
- [x] `equipment_types` 테이블 생성 (기구 종류 마스터)
- [x] `exercise_equipment_mappings` 테이블 생성 (운동-기구 매핑)
- [x] `user_favorites` 테이블 생성 (즐겨찾기)
- [x] `user_course_history` 테이블 생성 (사용자 코스 히스토리)
- [x] `user_pain_profiles` 테이블 생성 (사용자 통증 프로필)
- [x] `events` 테이블 생성 (분석용 이벤트)
- [x] 모든 테이블에 적절한 인덱스 생성
- [x] 외래키 제약조건 설정
- [x] 타임스탬프 자동 업데이트 트리거 설정

#### 1.2 재활 템플릿 데이터 준비

- [x] 재활 템플릿 100개 업로드
- [x] 템플릿 데이터 구조 설계 (부위, 강도, 시간, 기구별)
- [x] 템플릿 JSON 형식 정의
- [x] 템플릿 검증 로직 작성
- [x] 추가 운동 5개 업로드 (2026-01-09: 폼롤러 등 이완, 밴드 로우, 인클라인 푸쉬업, 밴드 팔 신전, 워킹 런지)

#### 1.3 부위 Bank 데이터 준비

- [ ] 부위 Bank 30개 업로드
- [x] 부위별 운동 매핑 구조 설계
- [x] 부위별 금기운동 정의

#### 1.4 템플릿-부위 매핑 구조 설계

- [x] 다중 부위 병합 로직 설계
- [x] 부위별 우선순위 정의
- [x] 템플릿-부위 매핑 테이블 설계

#### 1.5 운동 난이도 시스템 구현

- [x] "원리-적응-도움" 3단계 시스템 설계
- [x] 난이도별 운동 분류
- [x] 난이도 자동 조절 로직 구현

---

### 📌 2. 헬스장 API 연동 (네이버 API)

#### 2.1 네이버맵 API 기본 설정

- [x] 네이버 클라우드 플랫폼 계정 생성 (사용자 직접 진행) ✅ 완료 확인됨 (.env 파일에 키 존재)
- [x] 네이버맵 API 키 발급 (사용자 직접 진행) ✅ 완료 확인됨 (.env 파일에 키 존재)
- [x] 환경변수 설정 (.env 파일) - 가이드 문서 및 검증 유틸리티 구현 완료 ✅
- [x] API 호출량 모니터링 설정 - 모니터링 구조 구현 완료 (PRD 요구사항 충족) ✅

#### 2.2 장소 검색 API 연동

- [x] 네이버맵 장소 검색 API 연동 ✅
- [x] 검색 파라미터 정의 (반경 1km, 카테고리 등) ✅
- [x] API 응답 파싱 로직 작성 ✅
- [x] 에러 처리 및 재시도 로직 구현 ✅

#### 2.3 검색 결과 파싱

- [x] 이름, 주소, 좌표 파싱 ✅
- [x] 거리 계산 로직 구현 ✅
- [x] 데이터 정규화 및 검증 ✅

#### 2.4 운영시간 정보 파싱

- [x] 운영시간 데이터 구조 설계 ✅ (DB 스키마, 타입 정의 유지)
- [x] 운영시간 파싱 로직 작성 ✅ (Phase 2 완료: 24시간 감지, 요일 우선순위, 자정 넘김, 브레이크 타임)
- [x] 영업중 여부 판단 로직 구현 ✅ (Phase 2 완료: KST 기준, closingTime, nextOpenTime 계산)

#### 2.5 DB 캐싱 구현

- [x] 24시간 TTL 캐싱 로직 구현 ✅
- [x] 캐시 키 설계 (위치 기반) ✅
- [x] 캐시 무효화 전략 수립 ✅

#### 2.6 헬스장 정보 불러오기 API 개발

- [x] `/api/gyms/search` 엔드포인트 구현 ✅
- [x] 위치 기반 검색 로직 구현 ✅ (좌표 범위 계산 최적화 포함)
- [x] 필터링 기능 구현 (조용한 곳, 재활기구, 주차 등) ✅
- [x] 반경 1km 검색 로직 구현 ✅ (Haversine 공식)
- [x] 응답 데이터 포맷 정의 ✅

---

### 📌 3. 재활 운동 생성 엔진 v1

#### 3.1 사용자 입력 기반 부위 선택 기능

- [x] 부위 선택 UI 설계 ✅
- [x] 다중 부위 선택 로직 구현 ✅
- [x] 부위별 운동 템플릿 매핑 ✅

#### 3.2 다중 부위 병합 로직 구현

- [x] 부위 병합 알고리즘 설계 ✅
- [x] 우선순위 기반 운동 선택 로직 ✅
- [x] 중복 운동 제거 로직 ✅

#### 3.3 금기운동 필터링

- [x] 금기운동 데이터 구조 설계 ✅
- [x] 통증 정도별 금기운동 정의 ✅
- [x] 필터링 로직 구현 ✅

#### 3.4 운동 루틴 생성 로직

- [x] 준비 운동 생성 로직 (10-15분) ✅
- [x] 메인 운동 생성 로직 (60-70분) ✅
- [x] 마무리 운동 생성 로직 (10-15분) ✅
- [x] 총 시간 60/90/120분 맞추기 로직 ✅

#### 3.5 운동 시간 자동 조정

- [x] 사용자 입력 시간에 따른 조정 (60/90/120분) ✅
- [x] 운동별 시간 배분 알고리즘 ✅
- [x] 세트/횟수 자동 계산 ✅

#### 3.6 엔진 API 개발

- [x] `/api/rehab/generate` 엔드포인트 구현 ✅
- [x] 요청 파라미터 검증 (부위, 통증, 기구, 경험, 시간) ✅
- [x] 코스 생성 로직 통합 ✅
- [x] 응답 데이터 포맷 정의 ✅
- [x] 에러 처리 및 Fallback 코스 제공 ✅

---

### 📌 4. 프론트엔드 (모바일 웹)

#### 4.1 Next.js + Tailwind 초기 셋업

- [x] Next.js 15 프로젝트 구조 확인
- [x] Tailwind CSS v4 설정 확인
- [x] 모바일 우선 반응형 설정
- [x] 기본 레이아웃 컴포넌트 작성

#### 4.2 홈 화면 UI

- [x] 홈 화면 레이아웃 설계 (Hero Section + Features Section 완료)
- [x] 로그인/회원가입 버튼 (Clerk 모달 연동, /rehab 리다이렉트 완료)
- [ ] "내 주변 재활 헬스장 찾기" 버튼 (현재 제거됨, 향후 추가 예정)
- [x] "내 몸 상태로 재활 코스 만들기" 버튼 ✅ (PainCheckModal 연동, 2026-01-09)
- [ ] "최근 코스" 영역 (로컬스토리지 연동, 향후 추가 예정)
- [ ] 온보딩 플로우 구현

#### 4.3 부위 선택 화면 UI

- [ ] 채팅형 질문 UI 컴포넌트 작성 (일반 모달 형식으로 구현됨, 향후 개선 예정)
- [x] 부위 선택 UI (허리/어깨/무릎/목/기타) - BodyPartSelector 컴포넌트로 구현 완료
- [x] 통증 정도 선택 UI (1~5) - BodyPartSelector 내부에 구현 완료
- [x] 기구 선택 UI (매트/덤벨/머신/밴드/짐볼 등) - PainCheckModal Step 2에서 구현 완료
- [x] 운동 빈도 선택 UI - PainCheckModal Step 3에서 "운동 경험"으로 구현 완료
- [x] 운동 시간 선택 UI (60/90/120분) ✅ PainCheckModal Step 4에 구현 (2026-01-09)
- [x] 진행 상태 표시 (프로그레스 바) - PainCheckModal에 Step 1-4 진행 표시 구현 완료

#### 4.4 운동 결과 화면 UI

- [x] 코스 결과 레이아웃 설계 (Tabs 기반 섹션 구분 완료)
- [x] 준비-메인-마무리 섹션 구분 (classifyBySection 함수 사용 완료)
- [x] 운동별 시간/세트/횟수 표시 (CourseExerciseCard 컴포넌트로 구현 완료)
- [x] 주의사항 표시 (precautions 필드 표시 완료)
- [x] "이 코스 하기 좋은 근처 헬스장 보기" 버튼 (/gyms 페이지 이동 완료)
- [x] "코스 저장하기" 버튼 (/api/courses/save API 연동 완료)
- [x] 의료행위 아님 안내 문구 표시 (페이지 하단에 표시 완료)

#### 4.5 헬스장 리스트/지도 UI

- [x] 네이버맵 지도 컴포넌트 연동 (GymMap 컴포넌트로 구현 완료)
- [x] 지도 핀 표시 로직 (운영 상태별 색상 구분, InfoWindow 표시 완료)
- [x] 헬스장 리스트 UI (GymCard 컴포넌트로 구현 완료)
- [x] 지도/리스트 토글 기능 (토글 버튼으로 뷰 전환 완료)
- [x] 필터 UI (정렬: 거리순/평점순, 운영중만 보기 완료)
- [x] 반경 1km 표시 (radius: 1000m 설정 완료)
- [x] 위치 권한 처리 (Geolocation API 구현 완료)

#### 4.6 헬스장 상세 화면 UI ✅ 완료

- [x] API 응답 형식 통일 (GymDetailResponse 인터페이스 사용) ✅
- [x] 헬스장 기본 정보 표시 (이름, 주소, 운영시간, 가격대) ✅ (GymBasicInfo 컴포넌트)
- [x] 시설 정보 표시 ✅ (GymFacilities 컴포넌트, 5개 시설 항목: 재활기구, PT코치, 샤워실, 주차, 락커)
- [x] 운영시간 표시 ✅ (GymOperatingHours 컴포넌트, 요일별 표시, 오늘 요일 강조)
- [x] 태그 리뷰 표시 ✅ (GymReviews 컴포넌트, 리뷰 태그 통계 및 목록)
- [x] 즐겨찾기 버튼 ✅ (GymActions 컴포넌트, POST/DELETE /api/gyms/[id]/favorite API)
- [x] 리뷰 작성 버튼 ✅ (GymActions 컴포넌트, /gyms/[id]/review 페이지 이동)
- [x] 네이버맵 연동 (길찾기) ✅ (GymMapDirections 컴포넌트)
- [x] 혼잡도 표시 제거 ✅ (실시간 데이터 수집 불가능으로 인해 제거됨)
- [x] 다크 모드 지원 ✅ (모든 컴포넌트에 text-foreground, text-muted-foreground 적용)
- [x] 모바일 반응형 확인 ✅ (Tailwind 반응형 클래스 사용)

#### 4.7 리뷰 작성 화면 UI ✅ 완료

- [x] 리뷰 태그 목록 API 구현 ✅ (/api/review-tags GET)
- [x] 리뷰 작성 API 구현 ✅ (/api/reviews POST, 중복 제출 방지 포함)
- [x] 리뷰 작성 페이지 구현 ✅ (/gyms/[id]/review/page.tsx)
- [x] 태그 선택 UI ✅ (카테고리별 그룹화, 다중 선택, 최소 1개 필수)
- [x] 코멘트 입력 필드 ✅ (선택 사항, 최대 500자)
- [x] 리뷰 제출 로직 ✅ (ReviewForm 컴포넌트)
- [x] 중복 제출 방지 ✅ (API 및 클라이언트 양쪽에서 처리)
- [x] 에러 처리 및 성공 메시지 ✅
- [x] 다크 모드 지원 ✅
- [x] 모바일 반응형 확인 ✅

#### 4.8 로컬 저장 기능

- [x] localStorage 기반 즐겨찾기 저장
- [x] localStorage 기반 최근 코스 저장
- [x] 프라이빗 모드 감지 및 안내
- [x] 내 코스 페이지 구현 (`/my/courses`) ✅ (2026-01-09)
- [x] 코스 목록 API 구현 (`/api/courses` GET) ✅ (2026-01-09)
- [ ] 데이터 마이그레이션 로직 (향후 서버 저장 전환 대비)


#### 4.9 반응형 + 모바일 최적화

- [x] 모바일 터치 최적화
- [x] 스와이프 제스처 지원 (탭 전환)
- [x] 모바일 브라우저 호환성 테스트
- [x] PWA 기본 설정 (향후 확장)


---

### 📌 5. 리뷰 시스템

#### 5.1 리뷰 테이블 구축 ✅ 완료

- [x] `reviews` 테이블 스키마 확인 ✅ (2026-01-09 검증됨)
- [x] `review_tags` 마스터 데이터 입력 ✅ (10개 태그: positive 5개, negative 5개)
- [x] `review_tag_mappings` 관계 설정 ✅ (UNIQUE + CASCADE 제약조건 검증됨)

#### 5.2 태그형 빠른 리뷰 UI ✅ 완료

- [x] 태그 선택 컴포넌트 작성 ✅ (ReviewForm 컴포넌트, 카테고리별 그룹화)
- [x] 자주 쓰는 태그 상단 고정 ✅ (displayOrder 기반 정렬)
- [x] 탭 한 번으로 리뷰 완료 플로우 ✅ (최소 1개 태그 선택 + 제출)

#### 5.3 리뷰 작성 API ✅ 완료

- [x] `/api/reviews` POST 엔드포인트 구현 ✅
- [x] 태그 매핑 저장 로직 ✅ (트랜잭션 사용)
- [x] 운영자 리뷰 구분 (is_admin_review) ✅
- [x] 중복 제출 방지 ✅ (API + 클라이언트 양쪽 처리)

#### 5.4 리뷰 조회 API ✅ 완료

- [x] `/api/review-tags` GET 엔드포인트 구현 ✅ (10개 태그 반환 검증됨)
- [x] 헬스장별 리뷰 조회 ✅ (`/api/gyms/[id]` 응답에 포함됨)
- [x] 태그별 필터링 ✅ (클라이언트 사이드 그룹화 구현됨)
- [ ] 페이지네이션 구현 (향후 필요 시)

#### 5.5 헬스장 상세 페이지에서 리뷰 표시 ✅ 완료

- [x] 리뷰 리스트 컴포넌트 ✅ (GymReviews 컴포넌트)
- [x] 태그별 통계 표시 ✅
- [x] 리뷰 정렬 기능 (최신순) ✅

---

### 📌 6. 테스트 & 배포

#### 6.1 merge_engine 테스트코드 작성

- [ ] 단위 테스트 작성
- [ ] 다중 부위 병합 테스트
- [ ] 금기운동 필터링 테스트
- [ ] 시간 조정 로직 테스트

#### 6.2 API 기본 테스트 구축

- [ ] 헬스장 검색 API 테스트
- [ ] 코스 생성 API 테스트
- [ ] 리뷰 작성/조회 API 테스트
- [ ] 에러 케이스 테스트

#### 6.3 E2E 테스트

- [ ] 사용자 플로우 테스트 (온보딩 → 코스 생성 → 헬스장 찾기)
- [ ] 리뷰 작성 플로우 테스트
- [ ] 예외 상황 테스트 (위치 권한 거부, 네트워크 끊김 등)

#### 6.4 클라우드 서버 배포

- [ ] Vercel 배포 설정
- [ ] 환경변수 설정
- [ ] Supabase 프로젝트 설정
- [ ] 도메인 연결 (선택)
- [ ] HTTPS 설정 확인

#### 6.5 모니터링 및 로깅

- [ ] 에러 로깅 설정 (Sentry 등)
- [ ] API 호출량 모니터링
- [ ] 사용자 이벤트 트래킹 (events 테이블)
- [ ] 성능 모니터링

---

### 📌 7. 법/보안

#### 7.1 이용약관 및 개인정보 처리방침

- [ ] 이용약관 페이지 작성
- [ ] 개인정보 처리방침 페이지 작성
- [ ] 서비스 포지셔닝 명시 (의료행위 아님)
- [ ] 통증 악화 시 중단·전문의 상담 권고 문구

#### 7.2 코스 화면 안내 문구

- [ ] 모든 코스 화면에 "의료행위 아님" 문구 표시
- [ ] 통증 악화 시 중단 안내
- [ ] 전문의 상담 권고 문구

#### 7.3 보안 설정

- [ ] HTTPS 적용 확인
- [ ] 환경변수 보안 확인
- [ ] API 키 노출 방지
- [ ] XSS 방지 확인

---

## 🟦 PHASE 1 완료 기준

- [x] 현재/검색 위치 기준 반경 1km 내 장소 리스트 & 지도 표시 ✅
- [x] 장소 상세: 기본 정보(주소/운영시간/가격대), 시설정보, 태그 리뷰 ✅ (혼잡도는 제거됨)
- [x] 필터: 최소 3개(조용한 곳/재활기구/주차 등) 동작 ✅
- [x] 리뷰 작성: 태그 ≥1 + (선택) 코멘트 ✅ (5.1-5.5에서 구현 완료, 2026-01-09 검증됨)
- [x] 채팅형 질문 UI (최소 4–5문항) ✅ (PainCheckModal로 구현됨)
- [x] 부위/통증/기구/경험/시간 기반 기본 템플릿 조합 로직 ✅
- [x] 60/90/120분 코스 출력 (준비–메인–마무리 명시) ✅
- [x] "이 코스 하기 좋은 헬스장 보기" → 필터 자동 적용된 지도 연동 ✅
- [x] 모바일 웹 기준 반응형 레이아웃 ✅
- [x] 네이버맵 API 연동 & 치명적 버그 없는 수준의 지도/핀 인터랙션 ✅
- [ ] 기본 에러 로깅/트래킹 (FE/BE) (향후 구현 예정)
- [ ] 이용약관 및 개인정보 처리방침 페이지 제공 (향후 구현 예정)
- [x] 코스 화면에 "의료행위 아님 / 통증 악화 시 중단·전문의 상담" 문구 명시 ✅

---

## ✅ PHASE 2: Service Expansion & Refinement

### 🎯 목표

- 더 정교한 운동 추천
- 더 많은 부위/템플릿 확장
- 사용자 기록 관리
- 관리자 페이지 구축

---

### 📌 1. 재활 운동 엔진 v2

- [ ] 템플릿 200개로 확장
- [ ] 부위 Bank 50개 이상 확장
- [ ] 운동 제외 로직(금기 조건) 고도화
- [ ] 사용자 상태 기반 자동 난이도 조절
- [ ] "오늘의 추천 코스" 기능

---

### 📌 2. 장소 데이터 고도화

- [ ] 헬스장 데이터 사용자 제보 기능
- [ ] 운영시간 자동 검증 로직
- [ ] 리뷰 신뢰도 점수 시스템
- [ ] 헬스장 정렬 옵션(거리/영업중/리뷰순)

---

### 📌 3. 사용자 기능 강화

- [ ] 지난 운동 기록 저장
- [ ] 주차별 운동 히스토리 UI
- [ ] 부상 부위 프로필화
- [ ] 사용자 변화(통증, 가동범위) 저장 기능

---

### 📌 4. 관리자/운영자 기능

- [ ] 템플릿 CRUD 페이지
- [ ] 리뷰 관리 페이지
- [ ] 헬스장 정보 수정 페이지
- [ ] 운영자 인증 시스템

---

## 🟦 PHASE 2 완료 기준

- [ ] 개인 기록 기반 맞춤 재활 시스템이 동작
- [ ] 리뷰·헬스장 정보 품질이 자동으로 개선
- [ ] 관리자 페이지를 통한 운영 가능

---

## ✅ PHASE 3: Pro 기능 & 웨어러블 연동 준비

### 🎯 목표

- 사용자 데이터를 기반으로 운동 정확도 향상
- Wearable 센서 기반 재활 분석(준비 단계)
- 운동 이미지/모션 제공
- 글로벌화 시작

---

### 📌 1. 웨어러블 연동 준비

- [ ] HealthKit/Google Fit 구조 설계
- [ ] 걸음 수 기반 피로도 데이터 활용 로직
- [ ] 심박 기반 운동 강도 조정 로직 설계
- [ ] iOS/Android 연동은 미진행(사전 구조만 준비)

---

### 📌 2. AI 재활 코치 기능

- [ ] 운동 누락/오류 감지 로직
- [ ] 루틴 자동 수정 엔진
- [ ] 사용자 기록 기반 추천 강화

---

### 📌 3. 운동 이미지/모션 추가

- [ ] 2D 정적 이미지 템플릿 제작
- [ ] Lottie 또는 3D 모션 모델 준비
- [ ] 운동별 "올바른 자세" 모션 가이드 작성
- [ ] 앞으로의 자동 생성 로직 고려한 구조 설계

---

### 📌 4. 글로벌 확장

- [ ] 영어 템플릿 100개
- [ ] 글로벌 모드 UI
- [ ] 해외 헬스장 API 초기 검토

---

## 🟦 PHASE 3 완료 기준

- [ ] 데이터 기반 AI 재활 서비스 구조 완성
- [ ] 모션·이미지 기반 운동 가이드 제공 가능
- [ ] 글로벌 확장 준비 완료

---

## 📊 Success Criteria (PRD 기반)

### 핵심 지표

1. **등록 재활운동 & 헬스장 수**

   - 목표: 런칭 후 3개월 내 50개 이상
   - 측정: `is_active = true`이고 필수 정보가 입력 완료된 헬스장 개수

2. **리뷰(태그 리뷰) 수**

   - 목표: 3개월 내 총 200개 이상, 이 중 유저 리뷰 100개 이상
   - 측정: `is_deleted = false`인 태그 기반 리뷰 총 개수

3. **월간 활성 사용자(MAU)**
   - 목표: 3개월 차 기준 MAU 300명
   - 측정: 최근 30일 내 핵심 행동(view_map, click_gym_detail, complete_course_generation) 수행한 고유 사용자 수

### 보조 지표

- 재활 코스 생성 수: 3개월 내 누적 500회 이상
- 코스 생성 → 장소 탐색 전환율: 40% 이상
- 장소 상세 → 리뷰 작성 전환율: 10% 이상
- 2주 이내 재방문율: 25% 이상

---

## 📝 참고사항

- 본 TODO는 PRD.md의 "Definition of Done (MVP)" 섹션을 우선적으로 반영
- PRD의 "Nope (v1에서 하지 않을 것)" 섹션은 제외
- 각 Phase는 이전 Phase 완료 후 시작 권장
- 우선순위는 위에서 아래 순서로 진행
